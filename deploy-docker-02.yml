--- 
- name: Install python3, docker, docker-compose 
  hosts: docker_server
  become: yes
  gather_facts: False
  tasks: 
  - name: Install python3 and docker
    vars: 
      ansible_python_interpreter: /usr/bin/python
    ansible.builtin.yum:
      name: 
        - python3 
        - docker 
      update_cache: yes
      state: present
  - name: Create /usr/local/bin directory
    ansible.builtin.file:
      path: /usr/local/bin
      state: directory
  - name: Install Docker Compose
    shell: |
      curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-Linux-x86_64" -o /usr/local/bin/docker-compose
      chmod +x /usr/local/bin/docker-compose
    args:
      creates: /usr/local/bin/docker-compose

  - name: Check Docker Compose version
    command: "docker-compose --version"
    register: compose_version
    changed_when: false
    failed_when: false
  - name: Print Docker Compose version
    debug:
      var: compose_version.stdout_lines 
  
  - name: Start docker daemon 
    ansible.builtin.systemd:
      name: docker
      state: started
  - name: Install pip3 
    ansible.builtin.package:
      name: python3-pip
      state: present
  - name: Install Docker Python and Docker Compose libraries
    ansible.builtin.pip:
      name:
        - docker
        - docker-compose
  
- name: Add user to docker group 
  hosts: docker_server
  become: yes
  tasks:
  - name: add chinu to docker group
    ansible.builtin.user:
      name: chinu
      groups: docker
      append: yes
  - name: Reconnect to server session
    ansible.builtin.meta: reset_connection


- name: Test docker pull 
  hosts: docker_server
  become: yes
  tasks:
  - name: pull alpine
    community.docker.docker_image:
      name: alpine
      source: pull



